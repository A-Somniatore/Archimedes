Metadata-Version: 2.4
Name: archimedes
Version: 0.1.0
Classifier: Development Status :: 3 - Alpha
Classifier: Intended Audience :: Developers
Classifier: License :: OSI Approved :: MIT License
Classifier: License :: OSI Approved :: Apache Software License
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: Programming Language :: Python :: 3.12
Classifier: Programming Language :: Python :: Implementation :: CPython
Classifier: Programming Language :: Python :: Implementation :: PyPy
Classifier: Programming Language :: Rust
Classifier: Topic :: Internet :: WWW/HTTP :: HTTP Servers
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Dist: pytest>=7.0 ; extra == 'dev'
Requires-Dist: pytest-asyncio>=0.21 ; extra == 'dev'
Provides-Extra: dev
Summary: Python bindings for Archimedes HTTP server framework
Keywords: http,server,framework,contract-first,api
Author: Themis Platform Team
License: MIT OR Apache-2.0
Requires-Python: >=3.9
Description-Content-Type: text/markdown; charset=UTF-8; variant=GFM
Project-URL: Documentation, https://github.com/ThemisPlatform/archimedes/tree/main/crates/archimedes-py
Project-URL: Homepage, https://github.com/ThemisPlatform/archimedes
Project-URL: Repository, https://github.com/ThemisPlatform/archimedes

# Archimedes Python Bindings

Native Python bindings for the Archimedes HTTP server framework.

## Features

- **Contract-First**: Enforce API contracts with automatic request/response validation
- **High Performance**: Native Rust core with Python bindings via PyO3
- **Handler Decorators**: Pythonic `@app.handler` decorator pattern
- **Async Support**: Full async/await support with asyncio integration
- **Type Safety**: Rich type annotations and runtime validation
- **OpenTelemetry**: Built-in observability and distributed tracing

## Installation

### From PyPI (coming soon)

```bash
pip install archimedes
```

### From Source

Requires Rust toolchain and maturin:

```bash
# Install maturin
pip install maturin

# Build and install
cd crates/archimedes-py
maturin develop
```

## Quick Start

```python
from archimedes import App, Config, Response

# Configure the application
config = Config(
    contract_path="contract.json",
    listen_port=8080,
    enable_telemetry=True,
)

# Create the application
app = App(config)

# Register handlers using decorators
@app.handler("getUser")
def get_user(ctx):
    user_id = ctx.path_params.get("userId")
    return Response.ok({"id": user_id, "name": "John Doe"})

@app.handler("createUser")
def create_user(ctx):
    # Request body is automatically validated against the contract
    body = ctx.body
    return Response.created({"id": "new-123", "name": body.get("name")})

@app.handler("deleteUser")
def delete_user(ctx):
    if not ctx.identity.has_permission("user:delete"):
        return Response.forbidden("Not authorized to delete users")
    return Response.no_content()

# Run the server
if __name__ == "__main__":
    app.run()
```

## API Reference

### Config

```python
Config(
    contract_path: str,           # Path to the API contract JSON
    listen_port: int = 8080,      # Port to listen on
    listen_addr: str = "0.0.0.0", # Address to bind to
    enable_telemetry: bool = False,
    log_level: str = "info",
    service_name: str = "archimedes-python",
    opa_bundle_url: str | None = None,  # OPA policy bundle URL
)
```

### App

```python
app = App(config)

# Register a handler
@app.handler("operationId")
def handler(ctx):
    return {"key": "value"}  # Or return Response(...)

# Run the server
app.run()  # Blocking
await app.run_async()  # Async
```

### RequestContext

Available in handlers as the first argument:

```python
ctx.operation_id    # The operation ID being handled
ctx.path_params     # Path parameters as dict
ctx.query_params    # Query parameters as dict
ctx.headers         # Request headers as dict
ctx.body           # Parsed request body
ctx.identity       # Caller identity (if authenticated)
ctx.trace_id       # OpenTelemetry trace ID
ctx.span_id        # OpenTelemetry span ID
```

### Identity

```python
ctx.identity.subject     # Subject identifier
ctx.identity.issuer      # Token issuer
ctx.identity.audience    # Token audience
ctx.identity.roles       # List of roles
ctx.identity.permissions # List of permissions
ctx.identity.metadata    # Additional claims as dict

ctx.identity.has_role("admin")
ctx.identity.has_permission("user:read")
ctx.identity.is_expired()
```

### Response

```python
# Create responses using helper methods
Response.ok(body, headers=None)           # 200
Response.created(body, headers=None)      # 201
Response.no_content()                      # 204
Response.bad_request(message=None)         # 400
Response.unauthorized(message=None)        # 401
Response.forbidden(message=None)           # 403
Response.not_found(message=None)           # 404
Response.internal_error(message=None)      # 500
Response.json(body, status=200)            # JSON response

# Or construct directly
Response(status=200, body={"key": "value"}, headers={"X-Custom": "value"})
```

## Async Support

```python
import asyncio
from archimedes import App, Config

config = Config(contract_path="contract.json")
app = App(config)

@app.handler("getUser")
async def get_user(ctx):
    # Async handlers are supported
    user = await fetch_user(ctx.path_params["userId"])
    return {"user": user}

async def main():
    await app.run_async()

if __name__ == "__main__":
    asyncio.run(main())
```

## Building from Source

```bash
# Install development dependencies
pip install maturin pytest pytest-asyncio

# Build in development mode (includes debug symbols)
maturin develop

# Build release wheel
maturin build --release

# Run tests
pytest tests/
cargo test -p archimedes-py
```

## License

This project is licensed under either of:

- Apache License, Version 2.0 ([LICENSE-APACHE](../../LICENSE-APACHE) or http://www.apache.org/licenses/LICENSE-2.0)
- MIT license ([LICENSE-MIT](../../LICENSE-MIT) or http://opensource.org/licenses/MIT)

at your option.

